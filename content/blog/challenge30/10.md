---
title: '10'
date: 2021-02-21 16:02:60
category: challenge30
thumbnail: { thumbnailSrc }
draft: false
---

<자바스크립트 패턴과 테스트> 책을 읽고 있다. 테스트 주도 개발(TDD)를 꿈꿨지만 막상 작성하려고 하면 어설프고 제대로 하고 있는지 몰라 막막했다.
블로그 글들을 둘러봐도 TDD의 개념 위주로 설명하거나 과정을 생략하여 테스트 코드를 보여주는 식으로만 보여준다. 이 책은 테스트를 작성하는 과정을 
상세히 단계적으로 보여주어 같이 코드를 따라 치다보면 그 흐름에 나도 동참하는 듯한 기분(내가 글쓴이가 된 느낌이랄까)이 든다. 빨리 읽고 끝낼 생
각이었는데 시간을 들여 꼼꼼히 보도록 계획을 수정해야겠다.  

TDD를 할 때 제일 중요한 점은 실제 코드가 테스트보다 앞서면 안 된다는 것이다. 
실패하는 코드를 먼저 작성하라는 의미가 바로 이것이다. 실제 코드가 없으니 당연히 테스트가 실패하지 않겠는가?
테스트도 한 번에 생각해둔 모든 기능을 테스트하는 코드를 작성하지 않고 최소한의 기능 테스트를 작성해야 한다. 그렇다고 아무 생각없이 무작정
테스트를 작성하는 게 아니라 미리 어떤 기능들이 필요한지 그리고 그 기능을 실행시키기 위한 단계가 무엇인지 나름대로의 명세서를 작성해야 한다. 
가령 권한 여부에 따라 성공/실패 여부에 대한 알림 메세지를 출력하는 로직을 작성하고자 한다고 치자. 

맨 처음엔 인자가 제대로 들어왔는지 예외처리부터 시작한다. 즉 인자 '권한여부'라는 값이 undefined인지 boolean형이 아닌지를 
판단하고 제대로된 인자가 아니면 에러를 발생할 것을 기대하는 테스트를 작성한다. 당연히 내부 구현이 없기 때문에 실패한다. 
이제 이 테스트를 통과하기 위해 최소한의 코드를 작성한다. 통과가 되었다면 다음 테스트를 작성한다. 그리고 또 최소한의 코드를 작성하여 테스트를 
통과한다. 

책에서는 `describe`는 주로 클래스명 -> 함수명 와 같이 큰 개념에서 작은 개념, 큰 분류에서 작은 분류로 작성한다. 
예전 내가 하던 방식은 `alertByAuthority 함수 테스트` 였는데 이 책은 `alertByAuthority(authorized,alert)` 함수의 인터페이스를 
적는다. 아마도 테스트 코드를 작성할 때 어떤 인자를 넘겨야 할지 헛갈리지 않도록 하기 위함이지 않을까 한다. 

테스트 흐름 뿐만 아니라 고급 자바스크립트 기술도 알려준다. SOLID 원칙 중 개방/폐쇄 원칙을 지키기 위한 방법 중 하나인 AOP를 소개한다. 
이전에 만들어 둔 함수에 추가적인 기능을 덧붙여 사용하고 싶을 때 해당 함수를 수정하지 않는다. 해당 함수를 수정하면 테스트도 수정해야 하기 때문에
일이 배로 늘어나고 작은 수정이라 비슷한 테스트 코드를 '반복'하여 작성해야 하기 때문에 반복을 최소화하라는 DRY 원칙에도 어긋난다. AOP는 새로운 
애스팩트(관심)을 수행하는 코드를 기존 함수 실행 코드와 묶어 새로운 함수로 감싸는 기법이다. 내부 수정 없이 기능을 확장하는 방향으로 코드를 작성
할 수 있게 된다. 테스트 코드도 마찬가지로 기존 함수를 테스트하는 코드를 그대로 두고 감싼 함수만 테스트하는 코드를 작성하면 된다. 

아직 초반부까지 읽었는데도 TDD 방식이 자연스럽게 관심사를 좁히고 의존성 주입을 활용하는 등 유연한 코드를 작성하도록 유도한다는 걸 몸소 느끼고 
있다. 처음부터 100% 흡수할 거라 욕심내지 않고 조금씩 쌓아가자. 
