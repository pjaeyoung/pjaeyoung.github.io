---
title: '20210615'
date: 2021-06-15 22:06:04
category: sccap
thumbnail: { thumbnailSrc }
draft: false
---

## 스캡 프로젝트

- 기본폴더가 생성모드일 때와 아닐 때 위치가 고정이 안 돼서 머리가 아팠다.
- 특히나 `ScrollView` 안에서 `absolute position` 이 잘 안 먹힌다. 일단 이 엘리먼트와 씨름하고 나서야 명확히 알게 된 사실을 정리하자면 이렇다.

> ScrollView 엘리먼트 특징

- ScrollView의 크기와 상관없이 Item의 크기가 화면을 넘어서야 스크롤이 가능
- Item의 absolute position이 제대로 작동되지 않음
- Item은 relative position으로 위치를 잡아야 함
- 위의 이유로 기본폴더는 폴더 개수에 따라 위치가 계속 변동됨

- 그리고 `react-native-keyboard-accessory-view` 라이브러리를 분석해서 `KeyboardAccessoryView` 엘리먼트가 정확히 어떻게 렌더링될 지 (엘리먼트 Depth 구조) 확인하니 `renderScrollable` 엘리먼트와 키보드 상단 악세사리 엘리먼트가 형제 엘리먼트라는 사실을 알았다.
- 그래서 `keyboardAccessoryView` 를 감싼 상위 `View` 컴포넌트를 없애고 `floating` 버튼을 `renderScrollable` 에 렌더링하도록 했다.
- `editMode` 가 참/거짓 조건 모두 `floating` 버튼을 렌더링하여 버튼이 버벅거리면서 위치가 이동하지 않도록 했다.
- redux를 붙여 MAIN/SORT 화면 단에 `userFolders` 를 동기화시켰다. (아직 fs는 연결시키지 않은 상태)

```tsx
// FolderScreen 컴포넌트
// 최상단을 KeyboardAccesoryView로 지정함
<KeyboardAccessoryView
  renderScrollable={renderScrollable({
    editMode,
    setEditMode,
    folderName,
    setFolderName,
    borderColor,
    setBorderColor,
  })}
>
  {/* 악세사리 엘리먼트*/}
</KeyboardAccessoryView>
```

```tsx
// editMode 참/거짓 모두 위치와 클릭 이벤트만 다른 '가운데 floating 버튼'을 출력
const renderScrollable = ({
  editMode,
  setEditMode,
  folderName,
  setFolderName,
  borderColor,
  setBorderColor,
}: {
  editMode: boolean
  setEditMode: React.Dispatch<React.SetStateAction<boolean>>
  folderName: string
  setFolderName: React.Dispatch<React.SetStateAction<string>>
  borderColor: string
  setBorderColor: React.Dispatch<React.SetStateAction<string>>
}) => (panHandlers: GestureResponderHandlers) => {
  const inputRef = React.useRef() as React.RefObject<TextInput>
  const openKeyboard = () => {
    inputRef.current?.blur() // focus 상태를 한 번 풀어주고
    inputRef.current?.focus() // 다시 focus를 해야 키보드가 올라온다
  }

  React.useEffect(() => {
    Keyboard.addListener('keyboardDidHide', openKeyboard)
    return () => {
      Keyboard.removeListener('keyboardDidHide', openKeyboard)
    }
  }, [])

  const { userFolders, addUserFolder } = useUserFolders()
  const navigation = useNavigation()
  const newFolderIndex = userFolders.length
  const NewFolderSvg = FolderSvgs[newFolderIndex]
  const UserFolders = userFolders.map(
    ({ id, folderName, borderColor }, index) => {
      const FolderSvg = FolderSvgs[index]
      return (
        <FolderSvg
          key={id}
          style={userFolderLayoutData[index]}
          borderColor={borderColor}
        >
          <FolderName>{folderName}</FolderName>
        </FolderSvg>
      )
    }
  )

  return (
    <>
      {editMode && (
        <View
          style={{ width: '100%', height: Dimensions.get('screen').height }}
        >
          <FAB
            style={{
              zIndex: 99,
              position: 'absolute',
              width: 57,
              height: 57,
              left: Dimensions.get('screen').width * 0.5 - 57 * 0.5,
              top: 250,
            }}
            buttonStyle={{
              width: 57,
              height: 57,
              backgroundColor: '#2699FB',
            }}
            title={
              <Icon
                name="check"
                type="material"
                color="#fff"
                size={30}
                containerStyle={{ width: 57 }}
              />
            }
            onPress={() => {
              setEditMode(prev => !prev)
              if (editMode) {
                if (folderName.length !== 0) {
                  addUserFolder({
                    id: `${Date.now()}`,
                    folderName,
                    borderColor,
                  })
                  setBorderColor(
                    defaultBorderColors[userFolders.length + 1] || '#0CC2C2'
                  )
                }
                setFolderName('')
              }
            }}
          ></FAB>
          <ScrollView {...panHandlers} keyboardShouldPersistTaps="always">
            {UserFolders}
            <NewFolderSvg
              style={userFolderLayoutData[newFolderIndex]}
              borderColor={borderColor}
            >
              <TextInput
                style={{
                  position: 'absolute',
                  paddingLeft: 40,
                  textAlign: 'center',
                }}
                autoFocus
                ref={inputRef}
                placeholder="폴더명을 입력해주세요"
                value={folderName}
                onChangeText={setFolderName}
                returnKeyType="done"
                blurOnSubmit={true}
                onSubmitEditing={() => {
                  if (folderName.length !== 0) {
                    addUserFolder({
                      id: `${Date.now()}`,
                      folderName,
                      borderColor,
                    })
                    setBorderColor(
                      defaultBorderColors[userFolders.length + 1] || '#0CC2C2'
                    )
                  }
                  setFolderName('')
                  setEditMode(false)
                }}
              />
            </NewFolderSvg>
            <View
              style={{
                height: Dimensions.get('screen').height * 0.5,
              }}
            ></View>
          </ScrollView>
        </View>
      )}
      {!editMode && (
        <View
          style={{ width: '100%', height: Dimensions.get('screen').height }}
        >
          <FAB
            onPress={() => setEditMode(true)}
            style={{
              zIndex: 99,
              position: 'absolute',
              width: 57,
              height: 57,
              left: Dimensions.get('screen').width * 0.5 - 57 * 0.5,
              bottom: Dimensions.get('screen').height * 0.5,
            }}
            buttonStyle={{
              width: 57,
              height: 57,
              backgroundColor: '#2699FB',
            }}
            title={
              <Icon
                name="add"
                type="material"
                color="#fff"
                size={30}
                containerStyle={{ width: 57 }}
              />
            }
          />
          <FAB
            onPress={() => navigation.navigate('Main')}
            style={{
              zIndex: 99,
              position: 'absolute',
              width: 57,
              height: 57,
              right: 40,
              bottom: 150,
            }}
            buttonStyle={{ width: 57, height: 57, backgroundColor: '#2699FB' }}
            title={
              <Icon
                name="check"
                type="material"
                color="#fff"
                size={30}
                containerStyle={{ width: 57 }}
              />
            }
          />
          <BasicFolderSvg
            style={{ position: 'absolute', bottom: 150, left: 20 }}
          />
          {UserFolders}
        </View>
      )}
    </>
  )
}
```
