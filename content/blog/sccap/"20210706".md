---
title: '20210706'
date: 2021-07-06 23:07:44
category: TIL
thumbnail: { thumbnailSrc }
draft: false
---

## 스캡 프로젝트

- 기본폴더 터치 이벤트 및 PHOTO 삭제 alert 수정

  - 기본폴더와 유저폴더를 동시에 사용할 수 있도록 기존에 photo slice 를 적용하는 대신 파일시스템으로 이미지 load 와 이미지 삭제 기능을 완성함
  - navigation을 왔다 갔다하면서 react state가 제대로 업데이트 안 되는 이슈가 존재했음
    - 경우1) MAIN화면에서 CATEGORY 이동 : 분류한 이미지를 가져오려면 다시 MAIN에 나갔다가 들어와야 함
    - 경우2) PHOTO 화면에서 CATEGORY이동 : 삭제한 이미지가 여전히 렌더링되고 있음
    - stack에 쌓여있어도 컴포넌트가 refresh가 되도록 react navigation이 제공하는 기능 중 `useIsFocused` (해당 스크린이 focus 상태인지 여부를 알 수 있는 hook)을 사용함
    - `isFocused` 값을 useEffect의 두 번째 인자로 넣어 focus 상태가 바뀔 때마다 photo 데이터를 저장함

  ```tsx
  const isFocused = useIsFocused()
  useEffect(() => {
    async function setPhotosDataAsync() {
      const images = await RNFS.readFolder(
        folderId === 'basicFolder'
          ? RNFS.BASICFOLDER_FILEPATH
          : `${RNFS.FILEPATH}/${folderName}`
      )
      if (images.length === 0) {
        setError(
          '정리된 사진이 아직 없습니다 :( \n 스캡으로 스크린샷을 즉시 분류해보세요!'
        )
        return
      }

      isFocused &&
        setPhotosData(
          images.map(aImage => ({ id: folderId, source: aImage.path }))
        )
    }

    setPhotosDataAsync()
  }, [isFocused])
  ```

- CATEGORY 화면에서 사진 이미지가 한 줄을 못 채워도 가운데로 정렬되는 현상 수정

  - PhotoList 의 style에서 `alignItems : "center"` 부분을 `padding` 값만 주고 PhotoItem의 height과 width를 `Dimenstions.get("window").width*0.33-7` 로 잡음. 해당 공식은 padding값(7)을 제외한 3등분(0.33)으로 크기를 잡는 것

- 캡쳐 감지 토글 기능 구현
  - usePermissions에서 permission이 granted되면 무조건 monitorScreenshot을 실행하도록 되어있는 상태여서 토글로 끄더라도 매번 앱을 열때마다 forground가 실행됨
  - 이부분을 해결하기 위해 asyncStorage에서 스크린샷 감지 기능 여부를 boolean으로 저장하고 permission 체크 시 해당 값도 분기점에 포함시켜 해결함
- 사용방법 기능(온보딩 재실행) 구현
  - 온보딩 맨 처음에 '유저가 폴더 생성 후 온보딩을 더 이상 진행하지 않았을 경우' 를 대비해 매번 userFolders 초기화했기 때문에 SETTING화면에서 ONBOARDING으로 넘어갔을 때 기존에 만들어 놓은 폴더들이 싹 날라가는 심각한 버그가 존재했음
  - asyncStorage에서 가져온 completedOnboarding 여부에 따라 userFolders를 리셋할지 결정하여 해결함
  - 추가적으로 SETTING화면에서 넘어와 온보딩이 실행된 경우 ONBOARDING-05까지만 실행하도록 했음
- 친구에게 공유하기 기능은 PM분들께서 공유해야 할 컨텐트를 제공해주지 않은 상태라 일단 배제함.
- 리뷰작성하기 기능 : `react-native-in-app-review` 라이브러리를 적용했는데 실행해도 아무것도 나오지 않는다. 내부 오류인 건지 혹은 play store에 올려놓지 않은 상태라 구동이 되지 않는 것인지 모르겠다. (후자일 가능성이 높다)
- 피드백 보내기 기능 : `react-native-mail` 라이브러리를 사용하여 구현

* Notification 아이콘 수정
  - [Android Asset Studio](<https://romannurik.github.io/AndroidAssetStudio/icons-launcher.html#foreground.type=clipart&foreground.clipart=android&foreground.space.trim=1&foreground.space.pad=0.25&foreColor=rgba(96%2C%20125%2C%20139%2C%200)&backColor=rgb(68%2C%20138%2C%20255)&crop=0&backgroundShape=square&effects=none&name=ic_launcher>) 를 사용해서 ic_launcher icon을 생성함
