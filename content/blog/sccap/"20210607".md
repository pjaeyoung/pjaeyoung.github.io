---
title: '20210607'
date: 2021-06-07 23:06:66
category: sccap
thumbnail: { thumbnailSrc }
draft: false
---

- 깜빡잊고 지웠던 '배경에 투명도를 준 스크린샷 이미지 렌더링' 기능 추가
- 유저 폴더 렌더링

  - FolderSvgs는 HOC을 감싼 컴포넌트를 반환하는 역할만 하고 SortScreen에서 추후 Redux에서 가져온 폴더 데이터와 결합하는 방향으로 변경함
  - 생각해보니 유저 폴더 테두리 색상(borderColor)을 유동적으로 값(변수)을 받지 않고 있었음
  - 되도록 기본/공유/삭제 폴더와 통일시켜서 렌더링하고 싶은 마음 + FolderSvg 에서 borderColor와 style prop이 중복으로 겹치는 것 같아 style로 합치려고 했으나 타입에러로 실패함. 일단 따로 받는 방향으로 진행하기로 함

    ```tsx
    import React from 'react';
    import { View } from 'react-native';
    import Svg, { Path } from 'react-native-svg';
    import { IFolderSvgProps } from '@/shared/types';

    const FolderSvg: React.FC<IFolderSvgProps> = ({
      width,
      height,
      style,
      bg_d,
      border_d,
      ~~borderColor,~~  // 이부분을 삭제하고
      borderDashed = false,
      children,
    }) => {

      const { borderColor, ...resetStyle } = style; // 구조분행할당을 할 생각이었으나 실패

      return (
        <View style={[style, { justifyContent: 'center', alignItems: 'center' }]}>
          <Svg width={width} height={height} viewBox={`0 0 ${width} ${height}`} fill="none">
            <Path d={bg_d} fill="white" />
            <Path
              d={border_d}
              stroke={borderColor}
              strokeDasharray={borderDashed ? 8 : 0}
              strokeLinecap="round"
              strokeWidth="4"
            />
          </Svg>
          {children}
        </View>
      );
    };

    export default FolderSvg;
    ```

    ```tsx
    const withScaleAnimatedDropzone = ({
      Component,
      defaultSvgData,
      maxScale = 1.2,
    }: withScaleAnimatedDropzoneProps) => {
      const ScaleAnimatedDropzone: React.FC<ScaleAnimatedDropzoneProps> = ({
        style,
        children,
        borderColor,
        onDrop,
      }) => {
        ;/ **/

        return (
          <DraxView
            style={[
              {
                position: 'absolute',
              },
              style,
            ]}
            onReceiveDragOver={onReceiveDragOver}
            onReceiveDragExit={onReceiveDragExit}
            onReceiveDragDrop={onReceiveDragDrop}
          >
            <Animated.View style={[animatedStyle]}>
              // 어쩌정하게 borderColor를 받는 걸로 함
              <Component {...defaultSvgData} borderColor={borderColor}>
                {children}
              </Component>
            </Animated.View>
          </DraxView>
        )
      }

      return ScaleAnimatedDropzone
    }
    ```

- 공유 폴더 드롭시 공유 팝업창 출력

  - 처음에 react native 자체 API 중 `Share` 를 사용하려고 했으나 이미지 공유는 ios만 지원한다고 해서 대체 라이브러리 서치
  - `react-native-share` 라이브러리를 사용
  - 기존에 foreground에서 스크린샷 감지 시 file 경로만 전달했으나 `react-native-share` 라이브러리가 base64 형식을 요구하여 `react-native-fs` 라이브러리를 사용해서 base64 로 변환한 값도 같이 SORT 화면에 전달함

  ```tsx
  // backgroundService.ts
  const userDidScreenshot = (): void => {
    openApp(packageId)
      .then(isOpenedApp => {
        if (isOpenedApp) {
          // FIXME : 모든 안드로이드 기기에 대응할 수 있도록 파일 경로를 수정해야 합니다.
          return RNFS.readDir(
            `${RNFS.ExternalStorageDirectoryPath}/DCIM/Screenshots`
          )
        } else {
          throw new Error('ScCap 앱 실행이 실패했습니다.')
        }
      })
      .then(async result => {
        const lastIndex = result.length - 1
        // base64 만 허용하는 react-native-share 기능을 사용하기 위한 작업
        return Promise.all([
          Promise.resolve(result[lastIndex].path),
          RNFS.readFile(`file://${result[lastIndex].path}`, 'base64'),
        ])
      })
      .then(([screenshotPath, screenshotBase64]) => {
        navigate('Sort', { screenshotPath, screenshotBase64 })
      })
      .catch(e => console.warn(e))
  }
  ```

  ```tsx
  // SortScreen.tsx
  <ShareFolderSvg
    style={{ bottom: -60, left: '50%', transform: [{ translateX: -60 }] }}
    onDrop={() => {
      // backgroundService에서 받은 base64 값을 url로 전달함
      Share.open({
        title: '',
        url: `data:image/png;base64,${screenhsotBase64}`,
      })
        .then(res => {
          console.log(res)
        })
        .catch(err => {
          err && console.log(err)
        })
    }}
  />
  ```
