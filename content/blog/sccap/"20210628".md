---
title: '20210628'
date: 2021-06-29 14:06:17
category: TIL
thumbnail: { thumbnailSrc }
draft: false
---

## 스캡 프로젝트

- 스크린샷 감지 에러 해결을 위해 `react-native-detector` 를 수정했다.
- 문제는 `node_modules` 안에서 수정한 사항은 잘 작동되나 깃헙 레포에 반영이되지 않는다. (.gitignore로 제외시켰기 때문)
- 이 문제를 해결하는 방법으로 두가지가 존재했다.
  - 하나는 `node_modules` 밖으로 해당 모듈 폴더를 옮기고 package.json의 dependencies 경로를 `file:모듈 위치` 로 변경한 후 `yarn install` 한다. 이 방식은 로컬 작업에서만 하고 public repo에 올리지 않는 것을 권장한다.
  - 다른 하나는 해당 모듈이 올려진 깃헙 레포를 fork한 후 fork한 레포를 수정하고 `yarn add [http://github.com/(username)/(reponame).git](http://github.com/(username)/(reponame).git)` 으로 설치한다.
    [(참고링크)](https://www.imkh.dev/nodejs-modify-modules/)
- 두 번째 방법을 택해서 해결했다.
- 미생성된 스크린샷 이미지를 곧바로 가져와 오류를 뱉어냈던 부분

  - 디버깅으로 확인한 결과 스크린샷 경로에 `.pending` 이 붙어서 결과물을 가져온다는 것을 알게 되었다.

    ```bash
    /storage/emulated/0/DCIM/Screenshots/.pending-1625469659-Screenshot_20210628-162059_ScCap.jpg
    /storage/emulated/0/DCIM/Screenshots/Screenshot_20210628-162059_ScCap.jpg
    /storage/emulated/0/DCIM/Screenshots/Screenshot_20210628-162059_ScCap.jpg
    ```

  - 스크린샷 이미지 경로가 pending이 붙어있을 경우 함수 실행을 중단하여 해결했다.

  ```tsx
  const pendingRegex = /pending/

  const isPendingScreenshotPath = (path: string) => {
    return pendingRegex.test(path)
  }
  ```

- **이슈사항**
  - notification을 클릭했을 때 SCCAP이 열리지 않고 갤러리가 열리는 현상
  - 스크린샷 감지 후 앱실행 기능이 잘 안 됨 ⇒ 스캡앱이 열려있는 상태일 때만 잘 됨

## 비동기 개념 공부

- 동기적 처리는 기능을 완전히 수행, 완료하기 전까지 다음 기능 수행을 연기함
  - 대표적으로 Alert가 있음.
  - Alert는 확인을 누르기 전까지 다음 코드를 진행하지 않음 , 렌더링이 멈춤
- 비동기적 처리는 기능을 완료하기 전에 다음 기능을 수행하는 것이 가능함
  - 비동기적으로 수행하는 코드는 web api로 넘어가 완료된 작업을 이벤트 큐에 넣고 메인 쓰레드에 쌓인 단일 호출 스택이 비워질 때까지 대기
  - 메인 쓰레드의 스택이 다 비워지면 이벤트 큐에 들어간 테스크 실행
  - 대표적으로 fetch api가 있음
- 비동기적 처리는 콜백 패턴과 Promise 패턴 두 가지로 나눠짐
  - 콜백 패턴 : old style, 대표적인 예로 addEventListener
  - Promise는 : new style, 대표적인 예로 fetch , 대기/성공/실패라는 비동기 처리 상태를 나타내는 객체, then/catch 메서드 체이닝을 사용, then은 앞선 비동기적 처리가 성공적일 때 호출되고 catch는 실패했을 때 호출, 에러 핸들링이 용이, 순서대로 진행해야 할 여러 개의 비동기적 처리의 코드 복잡도를 낮추고 읽기 쉽게 함
