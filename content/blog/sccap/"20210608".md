---
title: '20210608'
date: 2021-06-08 22:06:27
category: sccap
thumbnail: { thumbnailSrc }
draft: false
---

- ì˜¤ëŠ˜ ìš°ì—°íˆ **'ìŠ¤í¬ë¦°ìƒ· ê°ì§€ í›„ ì•±ì‹¤í–‰'** ì„±ëŠ¥í–¥ìƒ ë°©ë²•ì„ ì°¾ê²Œ ë˜ì—ˆë‹¤. ğŸ˜‚

  - `react-native-detector` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì•„ë˜ì²˜ëŸ¼ ì§ì ‘ ìˆ˜ì •í–ˆë‹¤.

  ```kotlin
  // react-native-detector > DetectorModule.kt
  // ê¸°ì¡´ì— path ë„˜ê²¨ì£¼ì§€ ì•Šì€ ë¶€ë¶„ì„ ë„˜ê²¨ì£¼ë„ë¡ í•¨
  override fun onScreenCaptured(path: String) {
          reactContext
                  .getJSModule(DeviceEventManagerModule.RCTDeviceEventEmitter::class.java)
                  ~~.emit("UIApplicationUserDidTakeScreenshotNotification", null)~~
                  .emit("UIApplicationUserDidTakeScreenshotNotification", path)
  }
  ```

  ```tsx
  // react-native-detector > index.tsx
  // callbackì—ë„ path ë„˜ê²¨ì¤Œ
  export function addScreenshotListener(callback: Function) {
    if (Platform.OS === 'android') Detector.startScreenshotDetection();
    const eventEmitter = new NativeEventEmitter(Detector);
    eventEmitter.addListener(
      EventsName.UserDidTakeScreenshot,
      ~~() => callback(),~~
      (path) => callback(path),
      {}
    );

    return eventEmitter;
  }
  ```

  - ê·¸ë¦¬ê³  ìš°ë¦¬ ì•±ì—ì„œ `addScreenshotListener` ì˜ callbackì¸ `userDidScreenshot` ì—ì„œ ê³§ë°”ë¡œ pathë¥¼ ì „ë‹¬í•˜ë©´ ëœë‹¤.
  - íŠ¹ì´í•˜ê²Œ `openApp` ì˜ ì²« ë²ˆì§¸ `then` ì•ˆì—ì„œ íŒŒì¼ ì‘ì—…ì„ í•˜ë©´ ë¡œë”© ì†ë„ê°€ ëŠë¦°ë° ì•„ë˜ì²˜ëŸ¼ ë‘ ë²ˆì§¸ `then` ì—ì„œ í•˜ë©´ ë¹ ë¥´ê²Œ ë¡œë“œëœë‹¤. (ê·¸ë˜ë„ ì—¬ì „íˆ ì—¬ëŸ¬ ë²ˆ ìŠ¤í¬ë¦°ìƒ· í• ìˆ˜ë¡ í˜¸ì¶œ íšŸìˆ˜ê°€ ì¦ê°€í•œë‹¤)

  ```tsx
  // backgroundSerivce.ts
  const userDidScreenshot = (path: string): void => {
    // base64 ë§Œ í—ˆìš©í•˜ëŠ” react-native-share ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì‘ì—…
    Promise.all([
      `${path}`,
      RNFS.readFile(`file://${path}`, 'base64'),
      openApp(packageId),
    ])
      .then(([screenshotPath, screenshotBase64]) => {
        navigate('Sort', { screenshotPath, screenshotBase64 })
      })
      .catch(e => console.warn(e))
  }
  ```

  - í•œ ê°€ì§€ ì•„ì‰¬ìš´ ì ì€ ì•„ë˜ warning ë©”ì„¸ì§€ê°€ ë‚˜ì˜¨ë‹¤. ì¶”ì¸¡ìƒ ì´ë¯¸ì§€ ê²½ë¡œëŠ” ìƒì„±ë˜ì—ˆìœ¼ë‚˜ ì´ë¯¸ì§€ íŒŒì¼ì´ ìƒì„±ëœ ê²ƒì€ ì•„ë‹ˆë¼ì„œ ê³§ì¥ í•´ë‹¹ ê²½ë¡œì— ì ‘ê·¼í•´ë„ íŒŒì¼ì´ ì—†ë‹¤ê³  ë‚˜ì˜¤ëŠ” ê²ƒ ê°™ë‹¤. (ê·¸ë˜ì„œ `react-native-detector` ê°€ screenshot pathë¥¼ ì „ë‹¬í•˜ì§€ ì•Šì€ ê¹Œë‹­ì¼ì§€ë„). í˜¹ì€ `openApp` ìì²´ê°€ ë¬¸ì œì¼ì§€ë„ ëª¨ë¥¸ë‹¤. ìì„¸í•œ ê±´ ë‚˜ì¤‘ì— ì•Œì•„ë³´ì. ì§€ê¸ˆì€ íŒŒì¼ì‹œìŠ¤í…œì— ì§‘ì¤‘!

  ```tsx
  [Error: ENOENT: /storage/emulated/0/DCIM/Screenshots/.pending-1623761149-Screenshot_20210608-214549_Chrome.jpg: open failed: ENOENT (No such file or directory), open '/storage/emulated/0/DCIM/Screenshots/.pending-1623761149-Screenshot_20210608-214549_Chrome.jpg']
  ```

- í´ë” ìƒì„± / ì‚­ì œ , ì‚¬ë³¸ì´ë¯¸ì§€ ìƒì„±/ì‚­ì œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ
  - `react-native-fs` ì˜ `copyFile` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ì„œ ì‚¬ë³¸ ì´ë¯¸ì§€ ìƒì„±í•˜ë ¤ê³  í•  ë•Œ ê³„ì† `EISDIR: illegal operation on a directory` ì—ëŸ¬ê°€ ë‚˜ì„œ ì• ë¥¼ ë¨¹ì—ˆë‹¤. ì•Œê³ ë³´ë‹ˆ ë‚´ ì‹¤ìˆ˜.. [stackoverflow](https://stackoverflow.com/questions/58525721/eisdir-illegal-operation-on-a-directory-read-in-react-native-file-system) ì—ì„œ `destinationPath` ì˜ ë§ˆì§€ë§‰ì— íŒŒì¼ëª…ë„ ì¨ì¤˜ì•¼ í•œë‹¤ëŠ” ê±¸ ì•Œì•˜ë‹¤!
